# 自律開発システム

AEGIS Policy Engine用の完全自律開発システム。Claude Codeが自動でテスト→エラー分析→修正→コミット→プッシュを無限ループで実行します。

## 🎯 機能

- ✅ 完全自律（人間の介入不要）
- ✅ 無限ループ（Ctrl+Cで停止）
- ✅ 20分タイムアウト/ループ
- ✅ 自動Git管理（コミット+プッシュ）
- ✅ リアルタイムログ出力（JSON形式）
- ✅ 前回ログを次ループに引き継ぎ

## 🚀 使い方

### 1. 起動

```bash
cd /Users/shingo/Develop/aegis-policy-engine
./scripts/self-improve.sh
```

### 2. ログ監視（別ターミナル）

```bash
# 最新ログをリアルタイム表示
tail -f agent_logs/loop_*.log | tail -1

# または特定のループを監視
tail -f agent_logs/loop_1_*.log
```

### 3. 停止

実行中のターミナルで `Ctrl+C`

## 📊 動作フロー

```
┌─────────────────────────────────────────┐
│  Loop #N (commit: xxxxxx)               │
│  ┌───────────────────────────────────┐  │
│  │ 1. テスト実行（npm run test）    │  │
│  │    - 失敗したテストを検出        │  │
│  └───────────────────────────────────┘  │
│               ↓                         │
│  ┌───────────────────────────────────┐  │
│  │ 2. エラー分析                     │  │
│  │    - ソースコード読込             │  │
│  │    - 原因特定                     │  │
│  └───────────────────────────────────┘  │
│               ↓                         │
│  ┌───────────────────────────────────┐  │
│  │ 3. コード修正                     │  │
│  │    - Editツールで修正             │  │
│  │    - npm run build                │  │
│  │    - npm run test で検証          │  │
│  └───────────────────────────────────┘  │
│               ↓                         │
│  ┌───────────────────────────────────┐  │
│  │ 4. Git管理                        │  │
│  │    - git commit                   │  │
│  │    - git push                     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
               ↓
     Loop #N+1（前回ログを含む）
               ↓
            無限ループ...
```

## 📁 ログファイル

ログは `agent_logs/` ディレクトリに保存されます：

```
agent_logs/
├── loop_1_abc123_20260212_220844.log
├── loop_2_def456_20260212_222015.log
└── loop_3_ghi789_20260212_223145.log
```

ファイル名フォーマット: `loop_{ループ番号}_{コミットハッシュ}_{タイムスタンプ}.log`

## 🔧 カスタマイズ

### タイムアウト変更

`scripts/self-improve.sh` の以下を編集：

```bash
# 20分 → 30分に変更
for i in {1..1800}; do  # 1200 → 1800
```

### プロンプト変更

スクリプト内の `cat > /tmp/aegis_prompt.md` セクションを編集して、タスク内容をカスタマイズできます。

### モデル変更

```bash
# sonnet → opus に変更
--model opus
```

## 💡 Tips

- **初回実行**: 最初のループは時間がかかる場合があります
- **ログ形式**: JSON形式なので読みづらいですが、処理内容が詳細に記録されます
- **エラー時**: ループは自動継続します。複数回失敗すると次のエラーに進みます
- **放置推奨**: 数時間〜数日放置すると、自動で品質が向上します

## 📈 実績（Minecraftプロジェクトでの例）

- 24時間で75+ループ完了
- 20+件の自動バグフィックス
- インベントリ管理、アイテム収集、タイミング改善など

## ⚠️ 注意事項

- Git認証情報が必要（SSHキーまたはトークン）
- プッシュ権限が必要
- `ANTHROPIC_API_KEY` 環境変数が設定されている必要があります
- API使用料金が発生します（sonnetモデル使用）

## 🛠️ トラブルシューティング

### ログが出ない

- `--verbose --output-format stream-json` が有効か確認
- `tail -f` でログファイルを監視

### コミットされない

- Git設定（user.name, user.email）を確認
- コミット権限を確認

### プッシュ失敗

- リモートリポジトリへのアクセス権を確認
- SSH/HTTPS認証を確認

## 📝 元プロジェクト

このシステムは [minecraftAIViewer](https://github.com/Shin0205go/minecraftAIViewer) プロジェクトの自律改善システムを移植したものです。
