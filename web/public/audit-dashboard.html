<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AEGIS ç›£æŸ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 500;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .metric-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .metric-change {
            font-size: 14px;
            margin-top: 8px;
        }
        
        .metric-change.positive {
            color: #27ae60;
        }
        
        .metric-change.negative {
            color: #e74c3c;
        }
        
        .section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-badge.healthy {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-badge.warning {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-badge.critical {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .risk-level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .risk-level.low {
            background-color: #27ae60;
            color: white;
        }
        
        .risk-level.medium {
            background-color: #f39c12;
            color: white;
        }
        
        .risk-level.high {
            background-color: #e74c3c;
            color: white;
        }
        
        .risk-level.critical {
            background-color: #c0392b;
            color: white;
        }
        
        /* ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .compliance-summary {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .compliance-metric {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .compliance-metric h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #7f8c8d;
        }
        
        .compliance-rate {
            font-size: 36px;
            font-weight: bold;
            color: #27ae60;
        }
        
        #overall-risk-level {
            font-size: 24px;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
        }
        
        #overall-risk-level.LOW {
            background: #d4edda;
            color: #155724;
        }
        
        #overall-risk-level.MEDIUM {
            background: #fff3cd;
            color: #856404;
        }
        
        #overall-risk-level.HIGH {
            background: #f8d7da;
            color: #721c24;
        }
        
        .policy-breakdowns, .risk-factors, .recommendations {
            margin-top: 20px;
        }
        
        .risk-factor {
            background: #fff3cd;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #ffc107;
        }
        
        .risk-factor.HIGH {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .recommendation {
            background: #d1ecf1;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #17a2b8;
        }
        
        .alert-item {
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid;
            background-color: #f8f9fa;
        }
        
        .alert-item.low {
            border-color: #3498db;
        }
        
        .alert-item.medium {
            border-color: #f39c12;
        }
        
        .alert-item.high {
            border-color: #e74c3c;
        }
        
        .alert-item.critical {
            border-color: #c0392b;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .refresh-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            float: right;
        }
        
        .refresh-button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸ›¡ï¸ AEGIS ç›£æŸ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <div style="margin-top: 10px;">
                <a href="/" style="color: white; text-decoration: none; margin-right: 20px;">â† ãƒ›ãƒ¼ãƒ </a>
                <a href="/request-dashboard.html" style="color: white; text-decoration: none;">ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’</a>
            </div>
        </div>
    </div>
    
    <div class="container">
        <button class="refresh-button" onclick="refreshDashboard()">ğŸ”„ æ›´æ–°</button>
        
        <div id="loading" class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
        <div id="error" class="error" style="display: none;"></div>
        
        <div id="dashboard" style="display: none;">
            <!-- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ -->
            <div class="metrics-grid" id="realtime-metrics"></div>
            
            <!-- ã‚¢ãƒ©ãƒ¼ãƒˆ -->
            <div class="section" id="alerts-section">
                <h2>ğŸš¨ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¢ãƒ©ãƒ¼ãƒˆ</h2>
                <div id="alerts-container"></div>
            </div>
            
            <!-- ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆã‚°ãƒ©ãƒ• -->
            <div class="section">
                <h2>ğŸ“Š ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ</h2>
                <div class="chart-container">
                    <canvas id="access-chart"></canvas>
                </div>
            </div>
            
            <!-- ãƒˆãƒƒãƒ—ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚½ãƒ¼ã‚¹ -->
            <div class="section">
                <h2>ğŸ¯ ãƒˆãƒƒãƒ—ã‚¢ã‚¯ã‚»ã‚¹ãƒªã‚½ãƒ¼ã‚¹</h2>
                <div class="table-container">
                    <table id="top-resources-table">
                        <thead>
                            <tr>
                                <th>ãƒªã‚½ãƒ¼ã‚¹</th>
                                <th>ã‚¢ã‚¯ã‚»ã‚¹æ•°</th>
                                <th>æˆåŠŸç‡</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- ãƒˆãƒƒãƒ—ä½¿ç”¨ãƒ„ãƒ¼ãƒ« -->
            <div class="section">
                <h2>ğŸ”§ ãƒˆãƒƒãƒ—ä½¿ç”¨ãƒ„ãƒ¼ãƒ«</h2>
                <div class="table-container">
                    <table id="top-tools-table">
                        <thead>
                            <tr>
                                <th>ãƒ„ãƒ¼ãƒ«</th>
                                <th>ä½¿ç”¨å›æ•°</th>
                                <th>æˆåŠŸç‡</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ´»å‹• -->
            <div class="section">
                <h2>ğŸ‘¤ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ´»å‹•</h2>
                <div class="table-container">
                    <table id="agent-activity-table">
                        <thead>
                            <tr>
                                <th>ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</th>
                                <th>ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</th>
                                <th>æˆåŠŸç‡</th>
                                <th>ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- æ‹’å¦ç†ç”± -->
            <div class="section">
                <h2>ğŸš« æ‹’å¦ç†ç”±ãƒˆãƒƒãƒ—</h2>
                <div class="table-container">
                    <table id="denial-reasons-table">
                        <thead>
                            <tr>
                                <th>æ‹’å¦ç†ç”±</th>
                                <th>ç™ºç”Ÿå›æ•°</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ -->
            <div class="section">
                <h2>ğŸ“‹ ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ</h2>
                <div id="compliance-report">
                    <div class="compliance-summary">
                        <div class="compliance-metric">
                            <h3>ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç‡</h3>
                            <div class="compliance-rate" id="compliance-rate">-</div>
                        </div>
                        <div class="compliance-metric">
                            <h3>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</h3>
                            <div class="risk-level" id="overall-risk-level">-</div>
                        </div>
                    </div>
                    
                    <div class="policy-breakdowns">
                        <h3>ãƒãƒªã‚·ãƒ¼åˆ¥åˆ†æ</h3>
                        <div class="table-container">
                            <table id="policy-breakdown-table">
                                <thead>
                                    <tr>
                                        <th>ãƒãƒªã‚·ãƒ¼å</th>
                                        <th>ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°</th>
                                        <th>è¨±å¯ç‡</th>
                                        <th>å¹³å‡å‡¦ç†æ™‚é–“</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="risk-factors">
                        <h3>ãƒªã‚¹ã‚¯è¦å› </h3>
                        <div id="risk-factors-list"></div>
                    </div>
                    
                    <div class="recommendations">
                        <h3>æ¨å¥¨äº‹é …</h3>
                        <div id="recommendations-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let dashboardData = null;
        let accessChart = null;
        
        async function loadDashboard() {
            try {
                const response = await fetch('/api/audit/dashboard');
                if (!response.ok) throw new Error('Failed to load dashboard data');
                
                dashboardData = await response.json();
                updateDashboard();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
            } catch (error) {
                console.error('Dashboard error:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `ã‚¨ãƒ©ãƒ¼: ${error.message}`;
            }
        }
        
        function updateDashboard() {
            if (!dashboardData) return;
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
            updateRealtimeMetrics(dashboardData.realtime);
            
            // ã‚¢ãƒ©ãƒ¼ãƒˆæ›´æ–°
            updateAlerts(dashboardData.alerts);
            
            // ã‚°ãƒ©ãƒ•æ›´æ–°
            updateAccessChart(dashboardData.historical);
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
            updateTopResources(dashboardData.topMetrics.mostAccessedResources);
            updateTopTools(dashboardData.topMetrics.mostUsedTools);
            updateAgentActivity(dashboardData.topMetrics.mostActiveAgents);
            updateDenialReasons(dashboardData.topMetrics.topDenialReasons);
            
            // ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—
            loadComplianceReport();
        }
        
        function updateRealtimeMetrics(metrics) {
            const container = document.getElementById('realtime-metrics');
            container.innerHTML = `
                <div class="metric-card">
                    <h3>ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†</h3>
                    <div class="metric-value">${metrics.requestsPerMinute}</div>
                </div>
                <div class="metric-card">
                    <h3>ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ</h3>
                    <div class="metric-value">${metrics.activeAgents}</div>
                </div>
                <div class="metric-card">
                    <h3>å¹³å‡å¿œç­”æ™‚é–“</h3>
                    <div class="metric-value">${metrics.averageResponseTime}ms</div>
                </div>
                <div class="metric-card">
                    <h3>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«</h3>
                    <div class="risk-level ${metrics.currentRiskLevel.toLowerCase()}">${metrics.currentRiskLevel}</div>
                </div>
                <div class="metric-card">
                    <h3>ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹</h3>
                    <div class="status-badge ${metrics.systemHealth.toLowerCase()}">${metrics.systemHealth}</div>
                </div>
            `;
        }
        
        function updateAlerts(alerts) {
            const container = document.getElementById('alerts-container');
            if (alerts.length === 0) {
                container.innerHTML = '<p style="color: #666;">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ãƒ©ãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item ${alert.severity.toLowerCase()}">
                    <strong>${alert.type}</strong>: ${alert.message}
                    <br>
                    <small>${new Date(alert.timestamp).toLocaleString('ja-JP')}</small>
                </div>
            `).join('');
        }
        
        function updateAccessChart(historical) {
            const ctx = document.getElementById('access-chart').getContext('2d');
            
            if (accessChart) {
                accessChart.destroy();
            }
            
            const hourlyData = historical.hourly.slice(-24); // æœ€æ–°24æ™‚é–“
            
            accessChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hourlyData.map(d => new Date(d.timestamp).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })),
                    datasets: [
                        {
                            label: 'è¨±å¯',
                            data: hourlyData.map(d => d.allowedRequests),
                            borderColor: '#27ae60',
                            backgroundColor: 'rgba(39, 174, 96, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'æ‹’å¦',
                            data: hourlyData.map(d => d.deniedRequests),
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            tension: 0.3
                        },
                        {
                            label: 'ã‚¨ãƒ©ãƒ¼',
                            data: hourlyData.map(d => d.errorRequests),
                            borderColor: '#f39c12',
                            backgroundColor: 'rgba(243, 156, 18, 0.1)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'éå»24æ™‚é–“ã®ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function updateTopResources(resources) {
            const tbody = document.querySelector('#top-resources-table tbody');
            if (!resources || resources.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            tbody.innerHTML = resources.slice(0, 10).map(resource => `
                <tr>
                    <td>${resource.resource}</td>
                    <td>${resource.count}</td>
                    <td>${resource.successRate !== undefined ? resource.successRate.toFixed(1) + '%' : '-'}</td>
                </tr>
            `).join('');
        }
        
        function updateTopTools(tools) {
            const tbody = document.querySelector('#top-tools-table tbody');
            if (!tools || tools.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #666;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            tbody.innerHTML = tools.slice(0, 10).map(tool => `
                <tr>
                    <td>${tool.tool}</td>
                    <td>${tool.count}</td>
                    <td>${tool.successRate !== undefined ? tool.successRate.toFixed(1) + '%' : '-'}</td>
                </tr>
            `).join('');
        }
        
        function updateAgentActivity(agents) {
            const tbody = document.querySelector('#agent-activity-table tbody');
            if (!agents || agents.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            tbody.innerHTML = agents.slice(0, 10).map(agent => {
                const riskClass = agent.riskScore > 70 ? 'high' : 
                                 agent.riskScore > 40 ? 'medium' : 'low';
                return `
                <tr>
                    <td>${agent.agent}</td>
                    <td>${agent.count}</td>
                    <td>${agent.successRate !== undefined ? agent.successRate.toFixed(1) + '%' : '-'}</td>
                    <td><span class="risk-level ${riskClass}">${agent.riskScore !== undefined ? agent.riskScore.toFixed(0) : '-'}</span></td>
                </tr>
                `;
            }).join('');
        }
        
        function updateDenialReasons(reasons) {
            const tbody = document.querySelector('#denial-reasons-table tbody');
            if (!reasons || reasons.length === 0) {
                tbody.innerHTML = '<tr><td colspan="2" style="text-align: center; color: #666;">æ‹’å¦ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
                return;
            }
            tbody.innerHTML = reasons.slice(0, 10).map(reason => `
                <tr>
                    <td style="max-width: 600px; word-wrap: break-word;">${reason.reason}</td>
                    <td style="text-align: center;">${reason.count}</td>
                </tr>
            `).join('');
        }
        
        async function loadComplianceReport() {
            try {
                const response = await fetch('/api/audit/reports/latest');
                if (!response.ok) throw new Error('Failed to load compliance report');
                
                const report = await response.json();
                updateComplianceReport(report);
            } catch (error) {
                console.error('Compliance report error:', error);
            }
        }
        
        function updateComplianceReport(report) {
            if (!report) return;
            
            // ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç‡
            const complianceRate = document.getElementById('compliance-rate');
            if (report.summary?.complianceRate !== undefined) {
                complianceRate.textContent = report.summary.complianceRate.toFixed(1) + '%';
                complianceRate.style.color = report.summary.complianceRate >= 80 ? '#27ae60' : 
                                            report.summary.complianceRate >= 60 ? '#f39c12' : '#e74c3c';
            }
            
            // ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«
            const riskLevel = document.getElementById('overall-risk-level');
            if (report.riskAssessment?.overallRiskLevel) {
                riskLevel.textContent = report.riskAssessment.overallRiskLevel;
                riskLevel.className = report.riskAssessment.overallRiskLevel;
            }
            
            // ãƒãƒªã‚·ãƒ¼åˆ¥åˆ†æ
            const policyTbody = document.querySelector('#policy-breakdown-table tbody');
            if (report.policyBreakdowns && report.policyBreakdowns.length > 0) {
                policyTbody.innerHTML = report.policyBreakdowns.map(policy => `
                    <tr>
                        <td>${policy.policyName}</td>
                        <td>${policy.requestCount}</td>
                        <td>${policy.allowRate.toFixed(1)}%</td>
                        <td>${(policy.avgProcessingTime / 1000).toFixed(2)}ç§’</td>
                    </tr>
                `).join('');
            } else {
                policyTbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #666;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
            }
            
            // ãƒªã‚¹ã‚¯è¦å› 
            const riskFactorsList = document.getElementById('risk-factors-list');
            if (report.riskAssessment?.riskFactors && report.riskAssessment.riskFactors.length > 0) {
                riskFactorsList.innerHTML = report.riskAssessment.riskFactors.map(factor => `
                    <div class="risk-factor ${factor.severity}">
                        <strong>${factor.category}</strong>: ${factor.description} (ç™ºç”Ÿæ•°: ${factor.count})
                    </div>
                `).join('');
            } else {
                riskFactorsList.innerHTML = '<div style="color: #666;">ãƒªã‚¹ã‚¯è¦å› ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</div>';
            }
            
            // æ¨å¥¨äº‹é …
            const recommendationsList = document.getElementById('recommendations-list');
            if (report.recommendations && report.recommendations.length > 0) {
                recommendationsList.innerHTML = report.recommendations.map(rec => `
                    <div class="recommendation">${rec}</div>
                `).join('');
            } else {
                recommendationsList.innerHTML = '<div style="color: #666;">æ¨å¥¨äº‹é …ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
            }
        }
        
        function refreshDashboard() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            loadDashboard();
        }
        
        // åˆå›èª­ã¿è¾¼ã¿
        loadDashboard();
        
        // 30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>