# AEGIS ポリシー管理UI ガイド

## 概要

AEGIS ポリシー管理UIは、ODRLと自然言語の両方のポリシー形式に対応した統合管理インターフェースです。形式の自動検出機能により、ユーザーはポリシーの記述形式を意識することなく、直感的にポリシーを作成・管理できます。

## 主要機能

### 1. ポリシー形式の自動検出

UIは入力されたポリシーの形式を自動的に検出し、適切なエンジンで処理します。

```typescript
// 自動検出モードの設定
editorFormat: 'auto' | 'odrl' | 'natural'
```

**検出結果の表示**:
- 形式タイプ（ODRL / NATURAL_LANGUAGE）
- 信頼度（0-100%）
- カラーコード:
  - ODRL: 青色 (#2563eb)
  - 自然言語: 緑色 (#16a34a)
  - 不明: グレー (#6b7280)

### 2. ビジュアルエディタ

#### 左サイドバー - ポリシー一覧
- ポリシーの一覧表示
- ステータス表示（active / draft / archived）
- 形式バッジ表示
- クイック検索・フィルタリング

#### メインエディタ
- シンタックスハイライト対応
- リアルタイム形式検出
- プレースホルダーによるガイド
- JSONバリデーション（ODRL用）

#### テストパネル
- リアルタイムポリシーテスト
- コンテキスト設定
- 判定結果の詳細表示
- エンジン情報（ODRL/AI/Hybrid）

### 3. ポリシーテンプレート

事前定義されたテンプレートから素早くポリシーを作成できます。

#### 自然言語テンプレート
- **基本的なアクセス制御**: ロールベースの基本設定
- **データ保護ポリシー**: GDPR準拠のプライバシー設定
- **緊急時アクセスポリシー**: BCP対応の例外処理

#### ODRLテンプレート
- **時間ベースアクセス制御**: 営業時間の制限
- **ロールベースアクセス制御**: RBAC実装
- **データ利用制限**: 利用目的と期限の管理

### 4. 変数システム

テンプレート内の変数を動的に置換できます。

```javascript
// テンプレート内の変数定義
{{retentionDays}}  // データ保持日数
{{allowedRole}}    // 許可するロール
{{startTime}}      // 開始時刻
```

## 使用方法

### 新規ポリシーの作成

1. **「新規ポリシー作成」ボタンをクリック**
2. **形式を選択（または自動検出モード）**
3. **テンプレートを選択（オプション）**
4. **ポリシー内容を記述**
5. **テスト実行で動作確認**
6. **保存**

### ポリシーのテスト

```javascript
// テストコンテキストの設定例
{
  agent: 'test-user',
  action: 'read',
  resource: 'data://sensitive/file.json'
}
```

**テスト結果の確認項目**:
- 判定結果（PERMIT / DENY / INDETERMINATE）
- 判定理由
- 信頼度スコア
- 使用されたエンジン
- 適用される制約・義務

### 形式の切り替え

既存のポリシーを別の形式に変換する場合：

1. **手動変換**: エディタで書き直し
2. **AIアシスト**: 自然言語での説明からODRLを生成（将来機能）
3. **テンプレート利用**: 類似のテンプレートから作成

## ベストプラクティス

### 1. 形式の選び方

**自然言語を選ぶべき場合**:
- 複雑な条件や例外処理
- ビジネスロジックの表現
- 頻繁な変更が予想される
- 非技術者が管理する

**ODRLを選ぶべき場合**:
- 明確で単純なルール
- 高速な処理が必要
- 他システムとの連携
- 監査要件が厳格

### 2. テスト戦略

1. **基本ケース**: 典型的なアクセスパターン
2. **境界ケース**: 時間境界、ロール境界
3. **例外ケース**: 緊急時、特殊権限
4. **否定ケース**: 拒否されるべきアクセス

### 3. ポリシー管理

- **バージョン管理**: 重要な変更前にバックアップ
- **タグ付け**: カテゴリ、部門、コンプライアンス要件
- **定期レビュー**: 四半期ごとの見直し
- **ドキュメント**: 変更理由の記録

## トラブルシューティング

### 形式検出が正しくない場合

1. **信頼度を確認**: 70%未満の場合は手動指定を推奨
2. **キーワード確認**: ポリシーキーワードが含まれているか
3. **構文確認**: JSONの場合は構文エラーがないか

### テストが期待通りに動作しない場合

1. **コンテキスト確認**: 必要な情報が全て設定されているか
2. **ポリシー構文**: エラーや曖昧な表現がないか
3. **エンジン確認**: 適切なエンジンが選択されているか

## 今後の機能拡張

- **ビジュアルポリシービルダー**: ドラッグ&ドロップでポリシー作成
- **ポリシー分析**: 競合検出、カバレッジ分析
- **一括インポート/エクスポート**: CSV、YAML対応
- **コラボレーション機能**: コメント、承認フロー
- **監査ダッシュボード**: ポリシー適用状況の可視化