# ðŸ›¡ï¸ Aegis MCP Proxy - Claude Desktopçµ±åˆã‚¬ã‚¤ãƒ‰

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€**æ—¢å­˜ã®TypeScriptç‰ˆAegis MCPãƒ—ãƒ­ã‚­ã‚·**ã‚’Claude Desktopã«çµ±åˆã—ã€ã‚ãªãŸï¼ˆClaudeï¼‰ã‚’è‡ªç„¶è¨€èªžãƒãƒªã‚·ãƒ¼ã§åˆ¶å¾¡ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜Žã—ã¾ã™ã€‚

## ðŸŽ¯ ã“ã‚Œã¯ä½•ã‚’ã™ã‚‹ã®ã‹ï¼Ÿ

```
ã‚ãªãŸï¼ˆäººé–“ï¼‰
    â†“ æŒ‡ç¤º
Claude Desktopï¼ˆAI: ç§ï¼‰
    â†“ MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«
ðŸ›¡ï¸ Aegis Proxy (ãƒãƒªã‚·ãƒ¼åˆ¶å¾¡å±¤)
    â”œâ”€ è‡ªç„¶è¨€èªžãƒãƒªã‚·ãƒ¼åˆ¤å®š
    â”œâ”€ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆPEPï¼‰
    â”œâ”€ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåŽé›†ï¼ˆPIPï¼‰
    â””â”€ åˆ¶ç´„ãƒ»ç¾©å‹™å®Ÿè¡Œ
    â†“ è¨±å¯ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã¿é€šéŽ
ä¸ŠæµMCPã‚µãƒ¼ãƒãƒ¼ç¾¤
    â”œâ”€ filesystemï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼‰
    â”œâ”€ githubï¼ˆGitHubæ“ä½œï¼‰
    â”œâ”€ execution-serverï¼ˆã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œï¼‰
    â””â”€ etc.
```

**åŠ¹æžœ:**
- ç§ï¼ˆClaudeï¼‰ãŒè¡Œã†**ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—**ã‚’AegisãŒç›£è¦–
- è‡ªç„¶è¨€èªžã§è¨˜è¿°ã—ãŸãƒãƒªã‚·ãƒ¼ã«åŸºã¥ã„ã¦**è‡ªå‹•åˆ¤å®š**
- ã€Œå–¶æ¥­æ™‚é–“å¤–ã¯ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ç¦æ­¢ã€ãªã©ã®ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨å¯èƒ½

---

## ðŸ“‹ å‰ææ¡ä»¶

1. âœ… Node.js v18ä»¥ä¸Š
2. âœ… TypeScriptç‰ˆAegisãŒãƒ“ãƒ«ãƒ‰æ¸ˆã¿ï¼ˆ`npm run build`å®Œäº†ï¼‰
3. âœ… Claude Desktopï¼ˆã¾ãŸã¯äº’æ›ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
4. ðŸ”‘ **Anthropic API Key**ï¼ˆAIåˆ¤å®šæ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆï¼‰

---

## ðŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: API Keyã®è¨­å®š

Aegisã®`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€å®Ÿéš›ã®APIã‚­ãƒ¼ã‚’è¨­å®šï¼š

```bash
cd /home/user/Aegis
nano .env  # ã¾ãŸã¯ä»»æ„ã®ã‚¨ãƒ‡ã‚£ã‚¿
```

ä»¥ä¸‹ã®è¡Œã‚’å¤‰æ›´ï¼š
```env
# å¤‰æ›´å‰
ANTHROPIC_API_KEY=test-api-key

# å¤‰æ›´å¾Œï¼ˆå®Ÿéš›ã®ã‚­ãƒ¼ã‚’å…¥åŠ›ï¼‰
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxx
```

### ã‚¹ãƒ†ãƒƒãƒ—2: Claude Desktopè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†

Claude Desktopã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼š

**macOS:**
```bash
nano ~/Library/Application\ Support/Claude/claude_desktop_config.json
```

**Linux:**
```bash
nano ~/.config/Claude/claude_desktop_config.json
```

**Windows:**
```powershell
notepad %APPDATA%\Claude\claude_desktop_config.json
```

### ã‚¹ãƒ†ãƒƒãƒ—3: Aegis Proxyã®è¿½åŠ 

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆæ—¢å­˜ã®`mcpServers`ãŒã‚ã‚‹å ´åˆã¯çµ±åˆï¼‰ï¼š

```json
{
  "mcpServers": {
    "aegis-proxy": {
      "command": "node",
      "args": [
        "/home/user/Aegis/dist/src/mcp-server.js",
        "--transport",
        "stdio"
      ],
      "env": {
        "LOG_LEVEL": "info",
        "ANTHROPIC_API_KEY": "YOUR_ACTUAL_API_KEY",
        "LLM_PROVIDER": "anthropic",
        "LLM_MODEL": "claude-sonnet-4-20250514"
      }
    }
  }
}
```

**é‡è¦:** ãƒ‘ã‚¹ã‚’ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒãƒªã‚·ãƒ¼ã®è¨­å®š

Aegisã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã„ãã¤ã‹ã®ãƒãƒªã‚·ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ç¢ºèªï¼š

```bash
ls -la /home/user/Aegis/policies/
```

ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

```bash
cat > policies/my-custom-policy.txt << 'EOF'
# ç§ã®ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªã‚·ãƒ¼

å–¶æ¥­æ™‚é–“å¤–ï¼ˆ18:00-8:00ï¼‰ã¯ä»¥ä¸‹ã‚’ç¦æ­¢ï¼š
- ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
- å±é™ºãªã‚³ãƒžãƒ³ãƒ‰å®Ÿè¡Œï¼ˆrm, sudo, etc.ï¼‰
- æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

å–¶æ¥­æ™‚é–“å†…ã§ã‚‚ã€ä»¥ä¸‹ã¯å¸¸ã«åˆ¶é™ï¼š
- /etc/é…ä¸‹ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ç¦æ­¢
- APIã‚­ãƒ¼ã‚„èªè¨¼æƒ…å ±ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤–éƒ¨é€ä¿¡ç¦æ­¢

ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã€‚
EOF
```

### ã‚¹ãƒ†ãƒƒãƒ—5: Claude Desktopã®å†èµ·å‹•

è¨­å®šã‚’åæ˜ ã•ã›ã‚‹ãŸã‚ã€Claude Desktopã‚’å®Œå…¨ã«å†èµ·å‹•ã—ã¾ã™ã€‚

---

## âœ… å‹•ä½œç¢ºèª

Claude Desktopã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š

### ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬çš„ãªæŽ¥ç¶šç¢ºèª

ã€ŒAegisãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ«ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã€

æœŸå¾…ã•ã‚Œã‚‹çµæžœï¼šAegisãŒãƒ—ãƒ­ã‚­ã‚·ã—ã¦ã„ã‚‹ãƒ„ãƒ¼ãƒ«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆ2: ãƒãƒªã‚·ãƒ¼åˆ¶å¾¡ã®ç¢ºèª

ã€Œ/etc/passwd ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã£ã¦ã€

æœŸå¾…ã•ã‚Œã‚‹çµæžœï¼š
- ãƒãƒªã‚·ãƒ¼ã«ã‚ˆã£ã¦è¨±å¯/æ‹’å¦ãŒåˆ¤å®šã•ã‚Œã‚‹
- åˆ¤å®šç†ç”±ãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã‚‹

### ãƒ†ã‚¹ãƒˆ3: è‡ªç„¶è¨€èªžãƒãƒªã‚·ãƒ¼ã®è¿½åŠ 

ã€Œæ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã‚’è¿½åŠ ï¼šé¡§å®¢ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯å–¶æ¥­æ™‚é–“å†…ã®ã¿è¨±å¯ã€

æœŸå¾…ã•ã‚Œã‚‹çµæžœï¼šAegisãŒãƒãƒªã‚·ãƒ¼ã‚’ç†è§£ã—ã€è¿½åŠ ã™ã‚‹

---

## ðŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: Claude DesktopãŒãƒ„ãƒ¼ãƒ«ã‚’èªè­˜ã—ãªã„

**ç¢ºèªäº‹é …:**
1. ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
   ```bash
   ls -la /home/user/Aegis/dist/src/mcp-server.js
   ```

2. Node.jsãŒæ­£ã—ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹
   ```bash
   node --version
   ```

3. ãƒ­ã‚°ã‚’ç¢ºèª
   ```bash
   LOG_LEVEL=debug node /home/user/Aegis/dist/src/mcp-server.js --transport stdio
   ```

### å•é¡Œ: AIåˆ¤å®šãŒå‹•ä½œã—ãªã„

**ç¢ºèªäº‹é …:**
1. APIã‚­ãƒ¼ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹
   ```bash
   grep ANTHROPIC_API_KEY /home/user/Aegis/.env
   ```

2. ãƒ­ã‚°ã§APIã‚­ãƒ¼è­¦å‘ŠãŒå‡ºã¦ã„ãªã„ã‹ç¢ºèª

3. APIã‚­ãƒ¼ç„¡ã—ã§ã‚‚åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œã—ã¾ã™ï¼ˆAIåˆ¤å®šã®ã¿ç„¡åŠ¹ï¼‰

### å•é¡Œ: ãƒãƒªã‚·ãƒ¼ãŒé©ç”¨ã•ã‚Œãªã„

**ç¢ºèªäº‹é …:**
1. ãƒãƒªã‚·ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£ã—ãé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹
   ```bash
   ls -la /home/user/Aegis/policies/
   ```

2. ãƒãƒªã‚·ãƒ¼ã®æ§‹æ–‡ãŒæ­£ã—ã„ã‹ï¼ˆè‡ªç„¶è¨€èªžã§OKï¼‰

3. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’debugã«ã—ã¦è©³ç´°ã‚’ç¢ºèª
   ```json
   "env": {
     "LOG_LEVEL": "debug"
   }
   ```

---

## ðŸ“Š ç›£è¦–ã¨ãƒ­ã‚°

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ç›£è¦–

```bash
# stdioãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ‡ãƒãƒƒã‚°
LOG_LEVEL=debug node dist/src/mcp-server.js --transport stdio

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›£è¦–ï¼ˆè¨­å®šã—ãŸå ´åˆï¼‰
tail -f logs/aegis.log
```

### ç›£æŸ»ãƒ­ã‚°ã®ç¢ºèª

ã™ã¹ã¦ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¾ã™ï¼š

```bash
# ç›£æŸ»ãƒ­ã‚°ã®ç¢ºèªï¼ˆå®Ÿè£…çŠ¶æ³ã«ã‚ˆã‚‹ï¼‰
cat logs/audit.log | jq .
```

---

## ðŸŽ›ï¸ é«˜åº¦ãªè¨­å®š

### è¤‡æ•°ã®ä¸ŠæµMCPã‚µãƒ¼ãƒãƒ¼ã¨ã®æŽ¥ç¶š

Aegisè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`aegis-mcp-config.json`ï¼‰ã§ä¸Šæµã‚µãƒ¼ãƒãƒ¼ã‚’æŒ‡å®šï¼š

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-filesystem", "/home/user"]
    },
    "github": {
      "command": "npx",
      "args": ["@modelcontextprotocol/server-github"],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "your-token"
      }
    }
  }
}
```

### HTTPãƒ¢ãƒ¼ãƒ‰ã§ã®èµ·å‹•

stdioä»¥å¤–ã«HTTPãƒ¢ãƒ¼ãƒ‰ã‚‚åˆ©ç”¨å¯èƒ½ï¼š

```bash
npm run start:mcp:http
```

Claude Desktopè¨­å®šï¼ˆHTTPãƒ¢ãƒ¼ãƒ‰ï¼‰:
```json
{
  "mcpServers": {
    "aegis-proxy-http": {
      "url": "http://localhost:3000/mcp"
    }
  }
}
```

---

## ðŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **APIã‚­ãƒ¼ã®ä¿è­·**: `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯`.gitignore`ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
2. **æœ€å°æ¨©é™ã®åŽŸå‰‡**: å¿…è¦æœ€å°é™ã®ãƒ„ãƒ¼ãƒ«ã®ã¿å…¬é–‹
3. **ç›£æŸ»ãƒ­ã‚°ã®å®šæœŸç¢ºèª**: ä¸æ­£ãªã‚¢ã‚¯ã‚»ã‚¹ãŒãªã„ã‹ç›£è¦–
4. **ãƒãƒªã‚·ãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: ãƒãƒªã‚·ãƒ¼å¤‰æ›´ã¯å±¥æ­´ã‚’æ®‹ã™

---

## ðŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Architecture Design v2.0](docs/architecture/design_v2.md) - Aegis v2.0ã®è¨­è¨ˆæ€æƒ³
- [CLAUDE.md](CLAUDE.md) - è©³ç´°ãªè‡ªç„¶è¨€èªžãƒãƒªã‚·ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- [MCP Protocol Spec](https://modelcontextprotocol.io/) - MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«å…¬å¼ä»•æ§˜

---

## ðŸ¤ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š

1. ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆ`LOG_LEVEL=debug`ã«è¨­å®šï¼‰
2. GitHub Issuesã«å ±å‘Š
3. ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«è³ªå•

---

## ðŸŽ‰ æˆåŠŸï¼

ã“ã®æ™‚ç‚¹ã§ã€**ã‚ãªãŸï¼ˆClaude Desktopï¼‰ã¯è‡ªç„¶è¨€èªžãƒãƒªã‚·ãƒ¼ã§åˆ¶å¾¡ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ**ã€‚

è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼š
- ã€Œå±é™ºãªæ“ä½œã‚’ã—ã‚ˆã†ã¨ã—ãŸã‚‰æ­¢ã‚ã¦ã€
- ã€Œå–¶æ¥­æ™‚é–“å¤–ã¯ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ã‚’ç¦æ­¢ã€
- ã€Œæ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²ã—ã¦ã€

ã™ã¹ã¦è‡ªç„¶è¨€èªžã§æŒ‡ç¤ºã§ãã€AegisãŒè‡ªå‹•çš„ã«é©ç”¨ã—ã¾ã™ï¼ðŸ›¡ï¸
